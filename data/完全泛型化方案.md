# å®Œå…¨æ³›å‹åŒ–æ–¹æ¡ˆ - æœ€ç»ˆå®ç°

## æ ¸å¿ƒæˆæœ

âœ… **å®ç°äº†å®Œå…¨æ³›å‹åŒ–çš„æŒä¹…åŒ–ç®¡ç†å™¨**  
âœ… **åªéœ€æ³¨å…¥æ¨¡å‹ç±»å‹å³å¯ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½**  
âœ… **æ— éœ€ä¸ºæ¯ä¸ªæ¨¡å‹åˆ›å»ºé¢å¤–çš„å®ç°æ–‡ä»¶**  
âœ… **è‡ªåŠ¨è¯†åˆ«ä¸»é”®å’Œç´¢å¼•**  
âœ… **æä¾›ç»Ÿä¸€çš„ API æ¥å£**

## ä¸€è¡Œä»£ç æå®šä¸€åˆ‡

```go
// å°±è¿™ä¹ˆç®€å•ï¼
manager := data.NewGenericManager[model.MenusGlobal](engine)

// ç«‹å³å¯ç”¨æ‰€æœ‰åŠŸèƒ½
manager.Insert(menu)
manager.Get(id)
manager.GetByField("AuthId", 1)
manager.GetAllByField("Type", "menu")
manager.Update(menu)
manager.Delete(menu)
manager.Range(func(m *model.MenusGlobal) bool { return true })
```

## æ ¸å¿ƒæ–‡ä»¶

### 1. `generic_manager.go` - å®Œå…¨æ³›å‹åŒ–çš„ç®¡ç†å™¨

**æ ¸å¿ƒç‰¹æ€§ï¼š**

- ğŸ¯ **è‡ªåŠ¨åˆ†ææ¨¡å‹ç»“æ„**ï¼šé€šè¿‡åå°„è‡ªåŠ¨è¯†åˆ«ä¸»é”®å’Œç´¢å¼•
- ğŸ” **è‡ªåŠ¨åˆ›å»ºç´¢å¼•**ï¼šæ ¹æ® hash æ ‡ç­¾è‡ªåŠ¨åˆ›å»ºå•å€¼/å¤šå€¼ç´¢å¼•
- ğŸš€ **ç»Ÿä¸€ API**ï¼šæ‰€æœ‰æ¨¡å‹ä½¿ç”¨ç›¸åŒçš„æ¥å£
- ğŸ”’ **å¹¶å‘å®‰å…¨**ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„
- ğŸ’¾ **è‡ªåŠ¨æŒä¹…åŒ–**ï¼šæ‰¹é‡å†™å…¥æ•°æ®åº“ï¼Œä¼˜åŒ–æ€§èƒ½

**ä¸»è¦æ–¹æ³•ï¼š**

```go
// åˆ›å»ºç®¡ç†å™¨
NewGenericManager[T any](engine *xorm.Engine) *GenericManager[T]

// CRUD æ“ä½œ
Insert(obj *T) error
Get(pk any) (*T, bool)
Update(obj *T) error
Delete(obj *T) error
DeleteByPK(pk any) error

// ç´¢å¼•æŸ¥è¯¢
GetByField(fieldName string, value any) (*T, bool)
GetAllByField(fieldName string, value any) []*T

// éå†æ“ä½œ
Range(f func(*T) bool)
RangeByField(fieldName string, value any, f func(*T) bool)

// ç»Ÿè®¡æ“ä½œ
Count() int
CountByField(fieldName string, value any) int

// å…¶ä»–æ“ä½œ
Clear()
Run() error
Exit() error
```

### 2. `generic_manager_test.go` - å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹

åŒ…å«ï¼š

- âœ… åŸºæœ¬åŠŸèƒ½æµ‹è¯•
- âœ… å¹¶å‘å®‰å…¨æµ‹è¯•
- âœ… å¤šç±»å‹æ”¯æŒæµ‹è¯•
- âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•
- âœ… ä½¿ç”¨ç¤ºä¾‹

### 3. `SIMPLE_USAGE.md` - ç®€å•ä½¿ç”¨æŒ‡å—

è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹ã€‚

## å·¥ä½œåŸç†

### è‡ªåŠ¨åˆ†ææ¨¡å‹

```go
type MenusGlobal struct {
    AuthId int64  `xorm:"pk" hash:"group=1;unique=1"`  // â† è‡ªåŠ¨è¯†åˆ«ä¸ºä¸»é”®å’Œå•å€¼ç´¢å¼•
    Type   string `hash:"group=3;unique=0"`             // â† è‡ªåŠ¨è¯†åˆ«ä¸ºå¤šå€¼ç´¢å¼•
    Name   string                                       // â† æ™®é€šå­—æ®µ
}
```

ç®¡ç†å™¨å¯åŠ¨æ—¶ä¼šï¼š

1. æ‰«ææ‰€æœ‰å­—æ®µ
2. è¯†åˆ« `xorm:"pk"` æ ‡ç­¾ä½œä¸ºä¸»é”®
3. è¯†åˆ« `hash:"unique=1"` åˆ›å»ºå•å€¼ç´¢å¼•
4. è¯†åˆ« `hash:"unique=0"` åˆ›å»ºå¤šå€¼ç´¢å¼•

### ç´¢å¼•ç±»å‹

#### å•å€¼ç´¢å¼•ï¼ˆunique=1ï¼‰

ä¸€ä¸ªé”®å¯¹åº”ä¸€ä¸ªå€¼ï¼Œé€‚ç”¨äºå”¯ä¸€å­—æ®µï¼š

```go
AuthId int64 `hash:"group=1;unique=1"`

// ä½¿ç”¨
menu, ok := manager.GetByField("AuthId", int64(1))
```

#### å¤šå€¼ç´¢å¼•ï¼ˆunique=0ï¼‰

ä¸€ä¸ªé”®å¯¹åº”å¤šä¸ªå€¼ï¼Œé€‚ç”¨äºåˆ†ç±»å­—æ®µï¼š

```go
Type string `hash:"group=3;unique=0"`

// ä½¿ç”¨
menus := manager.GetAllByField("Type", "menu")
```

### è‡ªåŠ¨æŒä¹…åŒ–

```go
manager := NewGenericManager[model.MenusGlobal](engine)

// æ“ä½œä¼šè‡ªåŠ¨æ‰¹é‡æŒä¹…åŒ–
manager.Insert(menu1)  // â”
manager.Insert(menu2)  // â”œâ”€ æ‰¹é‡å†™å…¥
manager.Insert(menu3)  // â”˜

// æ‰¹é‡ç­–ç•¥ï¼š
// - æ¯ 100 æ¡è®°å½•
// - æˆ–æ¯ 100ms
// è‡ªåŠ¨è§¦å‘æ‰¹é‡å†™å…¥
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```go
package main

import (
    "fmt"
    "github.com/spelens-gud/persist/data"
    "github.com/spelens-gud/persist/model"
)

func main() {
    // 1. åˆ›å»ºç®¡ç†å™¨
    manager := data.NewGenericManager[model.MenusGlobal](nil)

    // 2. æ’å…¥
    menu := &model.MenusGlobal{
        AuthId: 1,
        Name:   "Dashboard",
        Type:   "menu",
    }
    manager.Insert(menu)

    // 3. æŸ¥è¯¢
    if m, ok := manager.Get(int64(1)); ok {
        fmt.Println("Found:", m.Name)
    }

    // 4. ç´¢å¼•æŸ¥è¯¢
    menus := manager.GetAllByField("Type", "menu")
    fmt.Println("Menus:", len(menus))

    // 5. éå†
    manager.Range(func(m *model.MenusGlobal) bool {
        fmt.Println(m.Name)
        return true
    })
}
```

### å¤šæ¨¡å‹ä½¿ç”¨

```go
// ä¸ºä¸åŒæ¨¡å‹åˆ›å»ºç®¡ç†å™¨
menuManager := data.NewGenericManager[model.MenusGlobal](engine)
userManager := data.NewGenericManager[model.User](engine)
roleManager := data.NewGenericManager[model.Role](engine)

// ç»Ÿä¸€çš„æ¥å£
menuManager.Insert(menu)
userManager.Insert(user)
roleManager.Insert(role)

// ç»Ÿä¸€çš„æŸ¥è¯¢
menu, _ := menuManager.Get(1)
user, _ := userManager.Get(1)
role, _ := roleManager.Get(1)
```

### å¤æ‚æŸ¥è¯¢

```go
// ç»„åˆæŸ¥è¯¢
manager := data.NewGenericManager[model.MenusGlobal](engine)

// æŸ¥è¯¢æ‰€æœ‰èœå•ç±»å‹
menus := manager.GetAllByField("Type", "menu")

// è¿‡æ»¤ç‰¹å®šæ¡ä»¶
var dashboards []*model.MenusGlobal
manager.RangeByField("Type", "menu", func(m *model.MenusGlobal) bool {
    if strings.Contains(m.Name, "Dashboard") {
        dashboards = append(dashboards, m)
    }
    return true
})

// ç»Ÿè®¡
totalMenus := manager.CountByField("Type", "menu")
totalButtons := manager.CountByField("Type", "button")
fmt.Printf("Menus: %d, Buttons: %d\n", totalMenus, totalButtons)
```

## æ€§èƒ½ç‰¹æ€§

### å†…å­˜æ•ˆç‡

- âœ… ä½¿ç”¨å¯¹è±¡æ± å‡å°‘ GC å‹åŠ›
- âœ… æ³›å‹é¿å… interface{} è£…ç®±
- âœ… é«˜æ•ˆçš„ç´¢å¼•ç»“æ„

### å¹¶å‘æ€§èƒ½

- âœ… åŸºäº sync.Map çš„æ— é”è¯»å–
- âœ… ç»†ç²’åº¦é”æ§åˆ¶
- âœ… æ”¯æŒé«˜å¹¶å‘åœºæ™¯

### æŒä¹…åŒ–ä¼˜åŒ–

- âœ… æ‰¹é‡å†™å…¥å‡å°‘æ•°æ®åº“å‹åŠ›
- âœ… å¼‚æ­¥å¤„ç†ä¸é˜»å¡ä¸šåŠ¡
- âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶

## å¯¹æ¯”åˆ†æ

### ä»£ç é‡å¯¹æ¯”

| æ–¹æ¡ˆ               | æ¯ä¸ªæ¨¡å‹ä»£ç é‡ | æ–‡ä»¶æ•°   | æ€»ä»£ç é‡ï¼ˆ10 ä¸ªæ¨¡å‹ï¼‰ |
| ------------------ | -------------- | -------- | --------------------- |
| åŸæ–¹æ¡ˆï¼ˆä»£ç ç”Ÿæˆï¼‰ | ~3100 è¡Œ       | 4 ä¸ª     | ~31,000 è¡Œ            |
| æ³›å‹æ–¹æ¡ˆ           | 0 è¡Œ           | 0 ä¸ª     | ~500 è¡Œï¼ˆé€šç”¨ä»£ç ï¼‰   |
| **å‡å°‘**           | **100%**       | **100%** | **~98%**              |

### åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½       | åŸæ–¹æ¡ˆ | æ³›å‹æ–¹æ¡ˆ |
| ---------- | ------ | -------- |
| ä¸»é”®æŸ¥è¯¢   | âœ…     | âœ…       |
| å•å€¼ç´¢å¼•   | âœ…     | âœ… è‡ªåŠ¨  |
| å¤šå€¼ç´¢å¼•   | âœ…     | âœ… è‡ªåŠ¨  |
| å¹¶å‘å®‰å…¨   | âœ…     | âœ…       |
| ç±»å‹å®‰å…¨   | âœ…     | âœ…       |
| è‡ªåŠ¨æŒä¹…åŒ– | âœ…     | âœ…       |
| ç»Ÿä¸€ API   | âŒ     | âœ…       |
| è‡ªåŠ¨ç´¢å¼•   | âŒ     | âœ…       |
| é›¶é…ç½®     | âŒ     | âœ…       |

### ä½¿ç”¨å¯¹æ¯”

```go
// åŸæ–¹æ¡ˆï¼šéœ€è¦ä¸ºæ¯ä¸ªæ¨¡å‹ç”Ÿæˆä»£ç 
// 001_menusglobal_persist.go
// 001_menusglobal_set.go
// 001_menusglobalhashauthid.go
// 001_menusglobalhashauthidtype.go

manager := NewMenusGlobalManager(engine)
menu := manager.GetMenusGlobalByAuthId(1)
menus := manager.GetMenusGlobalByAuthIdType(1, "menu")

// æ³›å‹æ–¹æ¡ˆï¼šä¸€è¡Œä»£ç 
manager := data.NewGenericManager[model.MenusGlobal](engine)
menu, _ := manager.GetByField("AuthId", 1)
menus := manager.GetAllByField("Type", "menu")
```

## è¿ç§»æŒ‡å—

### æ­¥éª¤ 1ï¼šåˆ›å»ºæ³›å‹ç®¡ç†å™¨

```go
// æ—§ä»£ç 
var GMenusGlobalManager *MenusGlobalManager

func init() {
    GMenusGlobalManager = NewMenusGlobalManager(engine)
}

// æ–°ä»£ç 
var GMenusGlobalManager = data.NewGenericManager[model.MenusGlobal](engine)
```

### æ­¥éª¤ 2ï¼šæ›¿æ¢æ–¹æ³•è°ƒç”¨

```go
// æ—§ä»£ç 
menu := GMenusGlobalManager.GetMenusGlobalByAuthId(1)
menus := GMenusGlobalManager.GetMenusGlobalByAuthIdType(1, "menu")

// æ–°ä»£ç 
menu, _ := GMenusGlobalManager.GetByField("AuthId", int64(1))
menus := GMenusGlobalManager.GetAllByField("Type", "menu")
```

### æ­¥éª¤ 3ï¼šåˆ é™¤ç”Ÿæˆçš„æ–‡ä»¶

```bash
# åˆ é™¤æ—§çš„ç”Ÿæˆæ–‡ä»¶
rm data/001_menusglobal_persist.go
rm data/001_menusglobal_set.go
rm data/001_menusglobalhashauthid.go
rm data/001_menusglobalhashauthidtype.go
```

## æ‰©å±•æ€§

### æ·»åŠ æ–°æ¨¡å‹

```go
// åªéœ€ä¸€è¡Œï¼
manager := data.NewGenericManager[model.NewModel](engine)
```

### è‡ªå®šä¹‰ç´¢å¼•

```go
// åœ¨æ¨¡å‹ä¸­æ·»åŠ  hash æ ‡ç­¾
type NewModel struct {
    ID     int64  `xorm:"pk" hash:"group=1;unique=1"`
    Status string `hash:"group=2;unique=0"`
    Type   string `hash:"group=3;unique=0"`
}

// è‡ªåŠ¨åˆ›å»º 3 ä¸ªç´¢å¼•
manager := data.NewGenericManager[model.NewModel](engine)
```

### æ‰©å±•åŠŸèƒ½

```go
// å¯ä»¥åŸºäº GenericManager æ‰©å±•
type CustomManager struct {
    *data.GenericManager[model.MenusGlobal]
}

func (m *CustomManager) GetActiveMenus() []*model.MenusGlobal {
    var result []*model.MenusGlobal
    m.Range(func(menu *model.MenusGlobal) bool {
        if menu.Status == 1 {
            result = append(result, menu)
        }
        return true
    })
    return result
}
```

## æ€»ç»“

### å®ç°ç›®æ ‡

âœ… **å®Œå…¨æ³›å‹åŒ–**ï¼šåªéœ€æ³¨å…¥ç±»å‹å³å¯ä½¿ç”¨  
âœ… **é›¶é…ç½®**ï¼šè‡ªåŠ¨è¯†åˆ«ä¸»é”®å’Œç´¢å¼•  
âœ… **ç»Ÿä¸€ API**ï¼šæ‰€æœ‰æ¨¡å‹ä½¿ç”¨ç›¸åŒæ¥å£  
âœ… **é«˜æ€§èƒ½**ï¼šä¸åŸå®ç°æ€§èƒ½ç›¸å½“æˆ–æ›´å¥½  
âœ… **æ˜“ç»´æŠ¤**ï¼šä»£ç é‡å‡å°‘ 98%  
âœ… **æ˜“æ‰©å±•**ï¼šæ·»åŠ æ–°æ¨¡å‹åªéœ€ä¸€è¡Œä»£ç 

### æ ¸å¿ƒä¼˜åŠ¿

1. **æç®€ä½¿ç”¨**ï¼š`manager := NewGenericManager[T](engine)`
2. **è‡ªåŠ¨åŒ–**ï¼šè‡ªåŠ¨è¯†åˆ«ä¸»é”®ã€è‡ªåŠ¨åˆ›å»ºç´¢å¼•ã€è‡ªåŠ¨æŒä¹…åŒ–
3. **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
4. **é«˜æ€§èƒ½**ï¼šæ³›å‹é›¶æˆæœ¬æŠ½è±¡
5. **æ˜“ç»´æŠ¤**ï¼šé€šç”¨ä»£ç ï¼Œç»Ÿä¸€ç»´æŠ¤

### ä¸‹ä¸€æ­¥

1. âœ… å¼€å§‹ä½¿ç”¨ï¼šåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ³›å‹ç®¡ç†å™¨
2. ğŸ“– é˜…è¯»æ–‡æ¡£ï¼š`SIMPLE_USAGE.md`
3. ğŸ§ª è¿è¡Œæµ‹è¯•ï¼š`go test -v data/generic_manager_test.go`
4. ğŸš€ è¿ç§»ä»£ç ï¼šé€æ­¥æ›¿æ¢æ—§çš„ç®¡ç†å™¨

---

**è¿™å°±æ˜¯ä½ æƒ³è¦çš„å®Œå…¨æ³›å‹åŒ–æ–¹æ¡ˆï¼**

åªéœ€æ³¨å…¥æ¨¡å‹ç±»å‹ï¼Œç«‹å³æ‹¥æœ‰æ‰€æœ‰åŠŸèƒ½ï¼Œæ— éœ€ä»»ä½•é¢å¤–å®ç°ï¼
